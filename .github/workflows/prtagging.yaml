name: Check for New Feature Label

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-new-feature:
    runs-on: ubuntu-latest
    steps:
      - name: Check if PR contains `[x] New feature`
        id: check_new_feature
        run: |
          if grep -q "\[x\] New feature" <<<"${{ github.event.pull_request.body }}"; then
            echo "new_feature=true" >> $GITHUB_ENV
          else
            echo "new_feature=false" >> $GITHUB_ENV
          fi

      - name: Add or remove `enhancement` label
        if: always()  # Ensure this step runs even if the previous one fails
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          new_feature: ${{ env.new_feature }}
        run: |
          NEW_FEATURE="${{ env.new_feature }}"
          PR_NUMBER="${{ github.event.pull_request.number }}"
          REPO="${{ github.repository }}"

          if [ "$NEW_FEATURE" == "true" ]; then
            echo "Adding enhancement label..."
            gh pr edit "$PR_NUMBER" --add-label "enhancement" --repo "$REPO"
          else
            echo "Removing enhancement label if it exists..."
            gh pr edit "$PR_NUMBER" --remove-label "enhancement" --repo "$REPO"
          fi

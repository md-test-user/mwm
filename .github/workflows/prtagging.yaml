name: Label Enhancement

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

jobs:
  label-enhancement:
    runs-on: ubuntu-latest

    steps:
      - name: Check PR body and manage labels
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_GITHUB }}
        run: |
          # Install jq for JSON parsing
          sudo apt-get update && sudo apt-get install -y jq

          # Get PR details
          PR_NUMBER=${{ github.event.pull_request.number }}
          OWNER=${{ github.event.repository.owner.login }}
          REPO=${{ github.event.repository.name }}

          # Get PR body
          PR_BODY=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            https://api.github.com/repos/$OWNER/$REPO/pulls/$PR_NUMBER | jq -r '.body')

          # Check for '- [x] New feature'
          if echo "$PR_BODY" | grep -q '\- \[x\] New feature'; then
            echo "New feature checked."
            # Add 'enhancement' label
            curl -s -X POST -H "Authorization: token $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github.v3+json" \
              https://api.github.com/repos/$OWNER/$REPO/issues/$PR_NUMBER/labels \
              -d '{"labels":["enhancement"]}'
          else
            echo "New feature not checked."
            # Remove 'enhancement' label if it exists
            curl -s -X DELETE -H "Authorization: token $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github.v3+json" \
              https://api.github.com/repos/$OWNER/$REPO/issues/$PR_NUMBER/labels/enhancement
          fi
